!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@riim/map-set-polyfill"),require("@riim/next-uid"),require("cellx"),require("@riim/mixin")):"function"==typeof define&&define.amd?define(["exports","@riim/map-set-polyfill","@riim/next-uid","cellx","@riim/mixin"],t):t(e.cellxIndexedCollections={},e.mapSetPolyfill,e.nextUID,e.cellx,e.mixin)}(this,function(e,t,i,n,r){"use strict";function o(e){this._indexesConfig=e&&e.indexes?e.indexes.map(function(e){return"string"==typeof e?{key:e}:e}):[{key:"id",valueGenerator:i.nextUID}],this._indexes=Object.create(null)}function l(e,t){o.call(this,t),n.ObservableMap.call(this,e,t)}function s(e,t){o.call(this,t),n.ObservableList.call(this,e,t)}var a=n.ObservableCollectionMixin.prototype,c=a._registerValue,u=a._unregisterValue;o.prototype={_registerValue:function(e){if(e===Object(e))for(var i=this._indexesConfig,n=this._indexes,r=i.length;r;){var o=i[--r],l=o.key,s=n[l]||(n[l]=new t.Map),a=e[l];if(void 0===a){var u=o.valueGenerator;if(u){do{a=u()}while(s.has(a));Object.defineProperty(e,l,{value:a})}}if(void 0!==a){var p=s.get(a);p?p.push(e):s.set(a,[e])}}c.call(this,e)},_unregisterValue:function(e){if(e===Object(e))for(var t=this._indexesConfig,i=this._indexes,n=t.length;n;){var r=t[--n].key,o=e[r];if(void 0!==o){var l=i[r],s=l.get(o);1==s.length?l.delete(o):s.pop()}}u.call(this,e)},clear:function(){this._indexes=Object.create(null),Object.getPrototypeOf(this.constructor.prototype).clear.call(this)}};var p=n.ObservableMap.prototype,f=p.contains,d=p.get;l.prototype=r.mixin({__proto__:n.ObservableMap.prototype},[o.prototype,{constructor:l,contains:function(e,t){if(void 0!==t){var i=this._indexes[t];return!!i&&i.has(e)}return f.call(this,e)},get:function(e,t){if(void 0===t)return d.call(this,e);var i=this._indexes[t];if(i){var n=i.get(e);return n&&n[n.length-1]}}}]);var x=n.ObservableList.prototype,h=x.contains,v=x.get;s.prototype=r.mixin({__proto__:n.ObservableList.prototype},[o.prototype,{constructor:s,contains:function(e,t){if(void 0!==t){var i=this._indexes[t];return!!i&&i.has(e)}return h.call(this,e)},get:function(e,t){if(void 0===t)return v.call(this,e);var i=this._indexes[t];if(i){var n=i.get(e);return n&&n[n.length-1]}}}]),e.IndexedCollectionMixin=o,e.IndexedMap=l,e.IndexedList=s,Object.defineProperty(e,"__esModule",{value:!0})});