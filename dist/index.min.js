!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@riim/map-set-polyfill"),require("@riim/next-uid"),require("cellx"),require("@riim/mixin")):"function"==typeof define&&define.amd?define(["exports","@riim/map-set-polyfill","@riim/next-uid","cellx","@riim/mixin"],t):t(e.cellxIndexedCollections={},e.mapSetPolyfill,e.nextUID,e.cellx,e.mixin)}(this,function(e,t,i,r,n){"use strict";function o(e){this._indexesConfig=e&&e.indexes?e.indexes.map(function(e){return"string"==typeof e?{key:e}:e}):[{key:"id",valueGenerator:i.nextUID}],this._indexes=Object.create(null)}function l(e,t){o.call(this,t),r.ObservableMap.call(this,e,t)}function s(e,t){o.call(this,t),r.ObservableList.call(this,e,t)}var a=r.ObservableCollection.prototype,c=a._registerValue,u=a._unregisterValue;o.prototype={_registerValue:function(e){if(e===Object(e))for(var i=this._indexesConfig,r=this._indexes,n=i.length;n;){var o=i[--n],l=o.key,s=r[l]||(r[l]=new t.Map),a=e[l];if(void 0===a){var u=o.valueGenerator;if(u){do{a=u()}while(s.has(a));Object.defineProperty(e,l,{value:a})}}if(void 0!==a){var p=s.get(a);p?p.push(e):s.set(a,[e])}}return c.call(this,e)},_unregisterValue:function(e){if(e===Object(e))for(var t=this._indexesConfig,i=this._indexes,r=t.length;r;){var n=t[--r].key,o=e[n];if(void 0!==o){var l=i[n],s=l.get(o);1==s.length?l.delete(o):s.pop()}}return u.call(this,e)},clear:function(){this._indexes=Object.create(null),Object.getPrototypeOf(this.constructor.prototype).clear.call(this)}};var p=r.ObservableMap.prototype,f=p.contains,d=p.get;l.prototype=n.mixin({__proto__:r.ObservableMap.prototype},[o.prototype,{constructor:l,contains:function(e,t){if(void 0!==t){var i=this._indexes[t];return!!i&&i.has(e)}return f.call(this,e)},get:function(e,t){if(void 0===t)return d.call(this,e);var i=this._indexes[t];if(i){var r=i.get(e);return r&&r[r.length-1]}}}]);var h=r.ObservableList.prototype,v=h.contains,x=h.get;s.prototype=n.mixin({__proto__:r.ObservableList.prototype},[o.prototype,{constructor:s,contains:function(e,t){if(void 0!==t){var i=this._indexes[t];return!!i&&i.has(e)}return v.call(this,e)},get:function(e,t){if(void 0===t)return x.call(this,e);var i=this._indexes[t];if(i){var r=i.get(e);return r&&r[r.length-1]}}}]),e.IndexedCollectionMixin=o,e.IndexedMap=l,e.IndexedList=s,Object.defineProperty(e,"__esModule",{value:!0})});